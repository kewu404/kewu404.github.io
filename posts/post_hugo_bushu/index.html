<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    

    
    <title>hugo部署到云服务器上</title>
    <meta name="description" content="hugo部署到云服务器上">
    <meta name="keywords" content='blog, gokarna, hugo'>

    <meta property="og:url" content="https://kewu404.github.io/posts/post_hugo_bushu/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="hugo部署到云服务器上">
    <meta property="og:description" content="hugo部署到云服务器上">
    <meta property="og:image" content="/images/avatar.webp">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="hugo部署到云服务器上">
    <meta name="twitter:description" content="hugo部署到云服务器上">
    <meta property="twitter:domain" content="https://kewu404.github.io/posts/post_hugo_bushu/">
    <meta property="twitter:url" content="https://kewu404.github.io/posts/post_hugo_bushu/">
    <meta name="twitter:image" content="/images/avatar.webp">

    
    <link rel="canonical" href="https://kewu404.github.io/posts/post_hugo_bushu/" />

    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link disabled id="dark-theme" rel="stylesheet" href="/css/dark.css">

    <script src="/js/jquery.min.js"></script>
    <script src="/js/feather-icons.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/main-jq.js"></script>
    <script src="/js/fish.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>

    
    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://kewu404.github.io/">
                <img src="/images/avatar.webp" alt="avatar" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://kewu404.github.io/">Naituyuw</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="/posts/"> 技术 </a>
            </div>
            
            <div class="nav-link">
                <a href="/projects/"> projects </a>
            </div>
            
            <div class="nav-link">
                <a href="/lives/"> 生活 </a>
            </div>
            
            <div class="nav-link">
                <a href="/tags/"> 标签 </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com/kewu404/"><span data-feather='github'></span>  </a>
            </div>
            
            <div class="nav-link">
                <a href="mailto:guojiuguo@gmail.com"><span data-feather='mail'></span>  </a>
            </div>
            
            <div class="nav-link">
                <a href="/index.xml"><span data-feather='rss'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="/posts/"> 技术 </a>
                </li>
                
                <li class="nav-item">
                    <a href="/projects/"> projects </a>
                </li>
                
                <li class="nav-item">
                    <a href="/lives/"> 生活 </a>
                </li>
                
                <li class="nav-item">
                    <a href="/tags/"> 标签 </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com/kewu404/"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item">
                    <a href="mailto:guojiuguo@gmail.com"><span data-feather='mail'></span>  </a>
                </li>
                
                <li class="nav-item">
                    <a href="/index.xml"><span data-feather='rss'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    
    
    <div class="post-header-section">
        <h1>hugo部署到云服务器上</h1>
        
        <p class="post-date">
            January 31, 2021
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="/tags/hugo">hugo</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <p><strong>过程 :</strong></p>
<p>​	hugo构建好的文件都是静态文件,我想要将<code>hugo</code>部署到服务器上,并使用nginx作为web服务器.</p>
<ol>
<li>
<p><strong>在服务器上安装nginx</strong></p>
<p>1.1 检查系统中有没有安装<code>gcc</code>、<code>pcre-devel</code>、<code>zlib-devel</code>、<code>openssl-devel</code>。</p>
<pre tabindex="0"><code>yum -y install gcc pcre-devel zlib-devel openssl openssl-devel
</code></pre><p>1.2 安装nginx</p>
<pre tabindex="0"><code>## 解压,将解压好的文件放在/usr/local/nginx里
tar -zxvf nginx-1.9.9.tar.gz

## 配置
./configure --prefix=/usr/local/nginx

# make
make
make install
</code></pre><p>1.3 测试是否安装成功</p>
<pre tabindex="0"><code># cd到刚才配置的安装目录/usr/local/nginx/
./sbin/nginx -t
</code></pre><blockquote>
<p>注意:</p>
<p>注意要把端口开放一下</p>
<p>我这里用的是阿里云的服务器,要去配置一下安全组,把80(nginx默认端口)端口开放一下</p>
</blockquote>
<p>1.4 可以配置一下开机自启</p>
<pre tabindex="0"><code>vim /etc/rc.d/rc.local
</code></pre><p>文件中:</p>
<pre tabindex="0"><code>/usr/local/nginx/sbin/nginx
</code></pre></li>
<li>
<p><strong>在服务器上安装git</strong></p>
<p>2.1 安装git</p>
<pre tabindex="0"><code>install git
</code></pre><p>2.2 创建一个用户<code>git</code>以及组<code>git</code>,用来运行<code>git</code>服务：</p>
<pre tabindex="0"><code>adduser git:git
</code></pre><p>2.3 密钥</p>
<p>收集所有需要登录的用户的公钥，就是他们自己的<code>id_rsa.pub</code>文件，把所有公钥导入到<code>/home/git/.ssh/authorized_keys</code>文件里，一行一个。</p>
<p>2.4 初始化<code>git</code>仓库</p>
<pre tabindex="0"><code>//在/home目录里创建一个文件,比如 gitrepo
cd /home/gitrepo
git init --bare demo.git
</code></pre><p>Git就会创建一个裸仓库，裸仓库没有工作区，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，并且服务器上的Git仓库通常都以<code>.git</code>结尾。然后，把owner改为<code>git</code>：</p>
<pre tabindex="0"><code>chown -R git:git demo.git
</code></pre><p>2.5 禁用shell登录</p>
<p>出于安全考虑，第二步创建的git用户不允许登录shell，这可以通过编辑<code>/etc/passwd</code>文件完成。找到类似下面的一行：</p>
<pre tabindex="0"><code>git❌1001:1001:,,,:/home/git:/bin/bash
</code></pre><p>改为:</p>
<pre tabindex="0"><code>git❌1001:1001:,,,:/home/git:/usr/bin/git-shell
</code></pre><p>这样，<code>git</code>用户可以正常通过ssh使用git，但无法登录shell，因为我们为<code>git</code>用户指定的<code>git-shell</code>每次一登录就自动退出。</p>
<p>2.6 克隆远程仓库</p>
<p>2.7 项目与裸仓库分开.这一步,我这边需要用到</p>
<p>这里主要是让nginx只想<code>hugo</code>打包好后的静态页面;在<code>/home/gitrepo/hooks</code>里创建脚本</p>
<pre tabindex="0"><code>cat &gt; post-receive
##内容
git --work-tree=/home/hugo --git-dir=/home/gitrepo/demo.git checkout -f
# --work-tree这个是指定项目要放在那里, --git-dir这个是git仓库地址

##给这个钩子文件添加执行的权限
chmod -x post-receive
</code></pre><blockquote>
<p>注意:</p>
<p>要看一下 <code>/home/hugo</code>的owner是谁,我这里一开始是root,后来推的时候,会提示没有权限,这里要改一下</p>
<pre tabindex="0"><code>chown [-R] user[:group] file
- R 表示以递归的方式来处理。
user 表示新拥有者的名称。这个名称必须是已存在的 Linux 账号。这个账号列表是 /etc/passwd。
file 表示需要修改拥有者的文件名称。
这里还有一个可选项 [:group]，利用它可以一次性把组名也修改掉。
</code></pre></blockquote>
</li>
<li>
<p>剩下的步骤</p>
<p>构建hugo,推到服务器上</p>
<pre tabindex="0"><code># 进入到构建好的hugo文件中,初始化git仓库
git init
# hugoblog是远程库的名字，xxxxx@xxxxxxxx是服务器地址，后面的是仓库的地址
git remote add hugoblog ssh://xxxxx@xxxxxxxx/home/git/demo.git 
git add .
git commit -m 'first'
git push hugoblog master
</code></pre><p>到服务器上<code>/home/hugo</code>里面看一下有没有项目文件,没有的话很大可能还是权限的问题</p>
<p>配置nginx,进入<code>/usr/local/nginx/config</code></p>
<pre tabindex="0"><code>vim nginx.conf
#修改server_name,改为自己购买的域名,注意格式
#修改root路径指向hugo中的index.html
</code></pre><p>最后启动nginx,完工</p>
</li>
</ol>
<p><strong>终 :</strong></p>
<p>​	这次碰到了git的钩子,感觉挺有意思的,之后可以试试</p>
        </p>
    </div>
</div>



    


        </main>
<div id="jsi-flying-fish-container" class="container-fish"></div>

<footer class="footer">
    <div class="nav-links">
        
        
        
    </div>
    <p></p>
    <div style="border:.1px solid rgb(41, 41, 41)"></div>
    <span>&copy; 2021 Naituyuw</span>
    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/526avijitgupta/gokarna">Gokarna</a>
    </span>
</footer>


</body></html>
